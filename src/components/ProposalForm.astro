---
import { Send, Mail, Phone, User, Building2, Briefcase, FileText, Calendar, DollarSign, CheckCircle } from 'lucide-astro';

const services = [
	{ id: 'consultoria', label: 'Consultoria Empresarial' },
	{ id: 'formacao', label: 'Forma√ß√£o e Capacita√ß√£o' },
	{ id: 'ti', label: 'Solu√ß√µes de TI' },
	{ id: 'gestao', label: 'Gest√£o de Projectos' },
	{ id: 'marketing', label: 'Marketing Digital' },
	{ id: 'contabilidade', label: 'Contabilidade e Finan√ßas' },
	{ id: 'rh', label: 'Recursos Humanos' },
	{ id: 'outro', label: 'Outro' },
];

const budgetRanges = [
	{ id: 'ate-50k', label: 'At√© 50.000 MZN' },
	{ id: '50k-150k', label: '50.000 - 150.000 MZN' },
	{ id: '150k-500k', label: '150.000 - 500.000 MZN' },
	{ id: '500k-1m', label: '500.000 - 1.000.000 MZN' },
	{ id: 'acima-1m', label: 'Acima de 1.000.000 MZN' },
	{ id: 'a-definir', label: 'A definir' },
];

const timelines = [
	{ id: 'urgente', label: 'Urgente (menos de 1 m√™s)' },
	{ id: '1-3-meses', label: '1 a 3 meses' },
	{ id: '3-6-meses', label: '3 a 6 meses' },
	{ id: '6-12-meses', label: '6 a 12 meses' },
	{ id: 'flexivel', label: 'Flex√≠vel' },
];
---

<section id="proposal-form" class="py-20 relative overflow-hidden">
	<!-- Background -->
	<div class="absolute inset-0 gradient-diagonal"></div>
	<div class="absolute top-0 left-0 w-96 h-96 bg-gold-500/5 rounded-full blur-3xl"></div>
	<div class="absolute bottom-0 right-0 w-96 h-96 bg-gold-500/5 rounded-full blur-3xl"></div>
	
	<div class="container mx-auto px-6 relative z-10">
		<div class="max-w-4xl mx-auto">
			<!-- Header -->
			<div class="text-center mb-12 animate-on-scroll">
				<div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gold-500/10 border border-gold-500/20 mb-6">
					<FileText class="w-4 h-4 text-gold-500" />
					<span class="text-gold-500 text-sm font-medium">Solicitar Proposta</span>
				</div>
				<h1 class="text-4xl md:text-5xl font-bold mb-4">
					<span class="text-white">Conte-nos sobre o</span>
					<span class="text-gold-500"> seu projecto</span>
				</h1>
				<p class="text-lg text-gray-400 max-w-2xl mx-auto">
					Preencha o formul√°rio abaixo com os detalhes do seu projecto e receber√° uma proposta personalizada em at√© 48 horas.
				</p>
			</div>

			<!-- Form -->
			<div class="glass-dark rounded-3xl p-8 md:p-10 border border-gold-500/20 animate-on-scroll" style="animation-delay: 0.1s;">
				<form id="proposal-form-element" class="space-y-8">
					<!-- Section: Dados Pessoais -->
					<div class="space-y-6">
						<h3 class="text-lg font-semibold text-gold-500 flex items-center gap-2 pb-2 border-b border-gold-500/20">
							<User class="w-5 h-5" />
							Dados de Contacto
						</h3>
						
						<div class="grid md:grid-cols-2 gap-6">
							<div>
								<label for="name" class="block text-sm font-medium text-gray-300 mb-2">
									Nome Completo *
								</label>
								<input 
									type="text" 
									id="name" 
									name="name" 
									required
									class="w-full px-4 py-3 rounded-xl bg-dark-50/50 border border-gold-500/20 text-white placeholder-gray-500 focus:outline-none focus:border-gold-500 focus:glow-gold transition-all"
									placeholder="O seu nome"
								/>
							</div>
							
							<div>
								<label for="email" class="block text-sm font-medium text-gray-300 mb-2">
									Email *
								</label>
								<input 
									type="email" 
									id="email" 
									name="email" 
									required
									class="w-full px-4 py-3 rounded-xl bg-dark-50/50 border border-gold-500/20 text-white placeholder-gray-500 focus:outline-none focus:border-gold-500 focus:glow-gold transition-all"
									placeholder="seu@email.com"
								/>
							</div>
							
							<div>
								<label for="phone" class="block text-sm font-medium text-gray-300 mb-2">
									Telefone *
								</label>
								<input 
									type="tel" 
									id="phone" 
									name="phone"
									required
									class="w-full px-4 py-3 rounded-xl bg-dark-50/50 border border-gold-500/20 text-white placeholder-gray-500 focus:outline-none focus:border-gold-500 focus:glow-gold transition-all"
									placeholder="+258 XX XXX XXXX"
								/>
							</div>
							
							<div>
								<label for="company" class="block text-sm font-medium text-gray-300 mb-2">
									Empresa / Organiza√ß√£o
								</label>
								<input 
									type="text" 
									id="company" 
									name="company"
									class="w-full px-4 py-3 rounded-xl bg-dark-50/50 border border-gold-500/20 text-white placeholder-gray-500 focus:outline-none focus:border-gold-500 focus:glow-gold transition-all"
									placeholder="Nome da empresa"
								/>
							</div>
						</div>
					</div>

					<!-- Section: Servi√ßos -->
					<div class="space-y-6">
						<h3 class="text-lg font-semibold text-gold-500 flex items-center gap-2 pb-2 border-b border-gold-500/20">
							<Briefcase class="w-5 h-5" />
							Servi√ßos Pretendidos
						</h3>
						
						<div class="grid grid-cols-2 md:grid-cols-4 gap-3">
							{services.map((service) => (
								<label class="relative cursor-pointer group">
									<input 
										type="checkbox" 
										name="services" 
										value={service.id}
										class="peer sr-only"
									/>
									<div class="px-4 py-3 rounded-xl border border-gold-500/20 bg-dark-50/30 text-gray-400 text-sm text-center transition-all peer-checked:border-gold-500 peer-checked:bg-gold-500/10 peer-checked:text-gold-500 hover:border-gold-500/50 hover:bg-dark-50/50">
										{service.label}
									</div>
									<div class="absolute top-1 right-1 w-4 h-4 rounded-full bg-gold-500 text-dark-200 items-center justify-center hidden peer-checked:flex">
										<CheckCircle class="w-3 h-3" />
									</div>
								</label>
							))}
						</div>
					</div>

					<!-- Section: Detalhes do Projecto -->
					<div class="space-y-6">
						<h3 class="text-lg font-semibold text-gold-500 flex items-center gap-2 pb-2 border-b border-gold-500/20">
							<FileText class="w-5 h-5" />
							Detalhes do Projecto
						</h3>
						
						<div>
							<label for="project-title" class="block text-sm font-medium text-gray-300 mb-2">
								T√≠tulo do Projecto *
							</label>
							<input 
								type="text" 
								id="project-title" 
								name="projectTitle"
								required
								class="w-full px-4 py-3 rounded-xl bg-dark-50/50 border border-gold-500/20 text-white placeholder-gray-500 focus:outline-none focus:border-gold-500 focus:glow-gold transition-all"
								placeholder="Ex: Implementa√ß√£o de Sistema de Gest√£o"
							/>
						</div>
						
						<div>
							<label for="description" class="block text-sm font-medium text-gray-300 mb-2">
								Descri√ß√£o do Projecto *
							</label>
							<textarea 
								id="description" 
								name="description" 
								required
								rows="5"
								class="w-full px-4 py-3 rounded-xl bg-dark-50/50 border border-gold-500/20 text-white placeholder-gray-500 focus:outline-none focus:border-gold-500 focus:glow-gold transition-all resize-none"
								placeholder="Descreva os objectivos, requisitos e expectativas do seu projecto..."
							></textarea>
						</div>
						
						<div class="grid md:grid-cols-2 gap-6">
							<div>
								<label for="budget" class="block text-sm font-medium text-gray-300 mb-2">
									<div class="flex items-center gap-2">
										<DollarSign class="w-4 h-4 text-gold-500" />
										Or√ßamento Estimado
									</div>
								</label>
								<select 
									id="budget" 
									name="budget"
									class="w-full px-4 py-3 rounded-xl bg-dark-50/50 border border-gold-500/20 text-white focus:outline-none focus:border-gold-500 focus:glow-gold transition-all"
								>
									<option value="" class="bg-dark-100">Seleccione...</option>
									{budgetRanges.map((range) => (
										<option value={range.id} class="bg-dark-100">{range.label}</option>
									))}
								</select>
							</div>
							
							<div>
								<label for="timeline" class="block text-sm font-medium text-gray-300 mb-2">
									<div class="flex items-center gap-2">
										<Calendar class="w-4 h-4 text-gold-500" />
										Prazo Desejado
									</div>
								</label>
								<select 
									id="timeline" 
									name="timeline"
									class="w-full px-4 py-3 rounded-xl bg-dark-50/50 border border-gold-500/20 text-white focus:outline-none focus:border-gold-500 focus:glow-gold transition-all"
								>
									<option value="" class="bg-dark-100">Seleccione...</option>
									{timelines.map((time) => (
										<option value={time.id} class="bg-dark-100">{time.label}</option>
									))}
								</select>
							</div>
						</div>
						
						<div>
							<label for="additional" class="block text-sm font-medium text-gray-300 mb-2">
								Informa√ß√µes Adicionais
							</label>
							<textarea 
								id="additional" 
								name="additional"
								rows="3"
								class="w-full px-4 py-3 rounded-xl bg-dark-50/50 border border-gold-500/20 text-white placeholder-gray-500 focus:outline-none focus:border-gold-500 focus:glow-gold transition-all resize-none"
								placeholder="Alguma informa√ß√£o adicional que considere relevante..."
							></textarea>
						</div>
					</div>

					<!-- Submit -->
					<div class="pt-4">
						<button 
							type="submit"
							class="w-full px-8 py-4 rounded-xl bg-gradient-to-r from-gold-600 to-gold-500 text-dark-200 font-semibold text-lg hover:glow-gold-lg transition-all transform hover:scale-[1.02] flex items-center justify-center gap-2"
						>
							<Send class="w-5 h-5" />
							Solicitar Proposta
						</button>
						
						<p class="text-center text-gray-500 text-sm mt-4">
							Ao submeter este formul√°rio, concorda com a nossa pol√≠tica de privacidade.
						</p>
					</div>

					<div id="form-message" class="hidden text-center py-4 rounded-xl"></div>
				</form>
			</div>

			<!-- Trust Badges -->
			<div class="mt-12 text-center animate-on-scroll" style="animation-delay: 0.2s;">
				<div class="flex flex-wrap justify-center gap-8 text-gray-400 text-sm">
					<div class="flex items-center gap-2">
						<CheckCircle class="w-5 h-5 text-gold-500" />
						<span>Resposta em 48h</span>
					</div>
					<div class="flex items-center gap-2">
						<CheckCircle class="w-5 h-5 text-gold-500" />
						<span>Proposta Personalizada</span>
					</div>
					<div class="flex items-center gap-2">
						<CheckCircle class="w-5 h-5 text-gold-500" />
						<span>Sem Compromisso</span>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

<script>
	const form = document.getElementById('proposal-form-element');
	const messageDiv = document.getElementById('form-message');
	
	if (form) {
		form.addEventListener('submit', async (e) => {
			e.preventDefault();
			
			const formData = new FormData(form);
			
			// Get selected services as array
			const services = formData.getAll('services');
			
			// Build message with all proposal details
			const data = {
				name: formData.get('name'),
				email: formData.get('email'),
				phone: formData.get('phone'),
				message: `
üìã SOLICITA√á√ÉO DE PROPOSTA

üë§ DADOS DE CONTACTO
Nome: ${formData.get('name')}
Email: ${formData.get('email')}
Telefone: ${formData.get('phone')}
Empresa: ${formData.get('company') || 'N√£o informado'}

üéØ SERVI√áOS PRETENDIDOS
${services.length > 0 ? services.join(', ') : 'N√£o especificado'}

üìù DETALHES DO PROJECTO
T√≠tulo: ${formData.get('projectTitle')}
Descri√ß√£o: ${formData.get('description')}

üí∞ Or√ßamento: ${formData.get('budget') || 'N√£o especificado'}
üìÖ Prazo: ${formData.get('timeline') || 'N√£o especificado'}

üìå Informa√ß√µes Adicionais:
${formData.get('additional') || 'Nenhuma'}
				`.trim()
			};
			
			// Show loading state
			const submitButton = form.querySelector('button[type="submit"]');
			const originalText = submitButton?.innerHTML;
			if (submitButton) {
				submitButton.disabled = true;
				submitButton.innerHTML = '<span class="animate-spin inline-block">‚è≥</span> Enviando...';
			}
			
			try {
				const response = await fetch('/api/contact', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(data)
				});

				const result = await response.json();

				if (response.ok && result.success) {
					if (messageDiv) {
						messageDiv.classList.remove('hidden', 'bg-red-500/10', 'text-red-400');
						messageDiv.classList.add('bg-green-500/10', 'text-green-400');
						messageDiv.innerHTML = `
							<div class="flex items-center justify-center gap-2">
								<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
								</svg>
								<span>Proposta solicitada com sucesso! Entraremos em contacto em at√© 48 horas.</span>
							</div>
						`;
					}
					form.reset();
				} else {
					if (messageDiv) {
						messageDiv.classList.remove('hidden', 'bg-green-500/10', 'text-green-400');
						messageDiv.classList.add('bg-red-500/10', 'text-red-400');
						messageDiv.textContent = '‚úó ' + (result.error || 'Erro ao enviar. Por favor, tente novamente.');
					}
				}
			} catch (error) {
				console.error('Erro ao enviar formul√°rio:', error);
				if (messageDiv) {
					messageDiv.classList.remove('hidden', 'bg-green-500/10', 'text-green-400');
					messageDiv.classList.add('bg-red-500/10', 'text-red-400');
					messageDiv.textContent = '‚úó Erro de conex√£o. Por favor, verifique a sua liga√ß√£o √† internet.';
				}
			} finally {
				if (submitButton) {
					submitButton.disabled = false;
					submitButton.innerHTML = originalText || 'Solicitar Proposta';
				}
				
				setTimeout(() => {
					if (messageDiv) {
						messageDiv.classList.add('hidden');
					}
				}, 8000);
			}
		});
	}
</script>
