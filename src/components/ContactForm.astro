---
import { Send, Mail, Phone, MapPin, User, MessageSquare, Clock, Building2, ShieldCheck, CheckCircle } from 'lucide-astro';
---

<section id="contact-form" class="py-20 relative overflow-hidden">
	<!-- Background -->
	<div class="absolute inset-0 gradient-diagonal"></div>
	<div class="absolute bottom-0 right-0 w-96 h-96 bg-gold-500/5 rounded-full blur-3xl"></div>
	<div class="absolute top-20 left-0 w-72 h-72 bg-gold-500/3 rounded-full blur-3xl"></div>
	
	<div class="container mx-auto px-6 relative z-10">
		<div class="max-w-6xl mx-auto">
			<div class="text-center mb-10 md:mb-12 px-2">
				<!-- Badge de tempo de resposta -->
				<div class="inline-flex items-center gap-2 px-4 py-2 mb-6 rounded-full bg-dark-50/60 border border-gold-500/30 text-sm text-gray-300 backdrop-blur-sm">
					<Clock class="w-4 h-4 text-gold-500" />
					<span>Tempo médio de resposta: <strong class="text-gold-500">1–2 dias úteis</strong></span>
				</div>
				
				<h2 class="text-3xl sm:text-4xl md:text-5xl font-bold mb-4">
					<span class="text-white">Entre em</span>
					<span class="text-gold-500"> Contacto</span>
				</h2>
				<p class="text-base sm:text-lg text-gray-400 max-w-2xl mx-auto">
					Tem uma questão ou projeto em mente? Preencha o formulário abaixo e entraremos em contacto consigo o mais breve possível.
				</p>
			</div>

			<div class="grid gap-8 md:grid-cols-2 md:gap-12">
				<!-- Contact Form -->
				<div class="glass-dark rounded-3xl p-6 md:p-8 border border-gold-500/20 animate-on-scroll">
					<form id="contact-form-element" class="space-y-6">
						<div>
							<label for="name" class="block text-sm font-medium text-gray-300 mb-2">
								<div class="flex items-center gap-2">
									<User class="w-4 h-4 text-gold-500" />
									Nome Completo
								</div>
							</label>
							<input 
								type="text" 
								id="name" 
								name="name" 
								required
								class="w-full px-4 py-3 rounded-xl bg-dark-50/50 border border-gold-500/20 text-white placeholder-gray-500 focus:outline-none focus:border-gold-500 focus:glow-gold transition-all"
								placeholder="O seu nome"
							/>
						</div>

						<div>
							<label for="email" class="block text-sm font-medium text-gray-300 mb-2">
								<div class="flex items-center gap-2">
									<Mail class="w-4 h-4 text-gold-500" />
									Email
								</div>
							</label>
							<input 
								type="email" 
								id="email" 
								name="email" 
								required
								class="w-full px-4 py-3 rounded-xl bg-dark-50/50 border border-gold-500/20 text-white placeholder-gray-500 focus:outline-none focus:border-gold-500 focus:glow-gold transition-all"
								placeholder="seu@email.com"
							/>
						</div>

						<div>
							<label for="phone" class="block text-sm font-medium text-gray-300 mb-2">
								<div class="flex items-center gap-2">
									<Phone class="w-4 h-4 text-gold-500" />
									Telefone
								</div>
							</label>
							<input 
								type="tel" 
								id="phone" 
								name="phone"
								class="w-full px-4 py-3 rounded-xl bg-dark-50/50 border border-gold-500/20 text-white placeholder-gray-500 focus:outline-none focus:border-gold-500 focus:glow-gold transition-all"
								placeholder="+258 XX XXX XXXX"
							/>
						</div>

						<div>
							<label for="company" class="block text-sm font-medium text-gray-300 mb-2">
								<div class="flex items-center gap-2">
									<Building2 class="w-4 h-4 text-gold-500" />
									Empresa / Organização
								</div>
							</label>
							<input 
								type="text" 
								id="company" 
								name="company"
								class="w-full px-4 py-3 rounded-xl bg-dark-50/50 border border-gold-500/20 text-white placeholder-gray-500 focus:outline-none focus:border-gold-500 focus:glow-gold transition-all"
								placeholder="Nome da sua empresa (opcional)"
							/>
						</div>

						<div>
							<label for="subject" class="block text-sm font-medium text-gray-300 mb-2">
								<div class="flex items-center gap-2">
									<MessageSquare class="w-4 h-4 text-gold-500" />
									Assunto
								</div>
							</label>
							<select 
								id="subject" 
								name="subject"
								required
								class="w-full px-4 py-3 rounded-xl bg-dark-50/50 border border-gold-500/20 text-white focus:outline-none focus:border-gold-500 focus:glow-gold transition-all"
							>
								<option value="" class="bg-dark-100">Selecione um assunto</option>
								<option value="consultoria" class="bg-dark-100">Consultoria Empresarial</option>
								<option value="procurement" class="bg-dark-100">Procurement & Licitações</option>
								<option value="formacao" class="bg-dark-100">Formação & Capacitação</option>
								<option value="planeamento" class="bg-dark-100">Planeamento Territorial</option>
								<option value="inovacao" class="bg-dark-100">Inovação Digital</option>
								<option value="parceria" class="bg-dark-100">Proposta de Parceria</option>
								<option value="outro" class="bg-dark-100">Outro Assunto</option>
							</select>
						</div>

						<div>
							<label for="message" class="block text-sm font-medium text-gray-300 mb-2">
								<div class="flex items-center gap-2">
									<MessageSquare class="w-4 h-4 text-gold-500" />
									Mensagem
								</div>
							</label>
							<textarea 
								id="message" 
								name="message" 
								required
								rows="5"
								class="w-full px-4 py-3 rounded-xl bg-dark-50/50 border border-gold-500/20 text-white placeholder-gray-500 focus:outline-none focus:border-gold-500 focus:glow-gold transition-all resize-none"
								placeholder="Conte-nos sobre o seu projeto ou questão..."
							></textarea>
						</div>

						<!-- Nota de confidencialidade -->
						<div class="flex items-start gap-2 text-xs text-gray-400">
							<ShieldCheck class="w-4 h-4 text-gold-500/70 mt-0.5 flex-shrink-0" />
							<span>
								Ao enviar, concorda em ser contactado pela BMC Pro e autoriza o tratamento dos dados fornecidos com total confidencialidade.
							</span>
						</div>

						<button 
							type="submit"
							class="w-full px-8 py-4 rounded-xl bg-gradient-to-r from-gold-600 to-gold-500 text-dark-200 font-semibold hover:glow-gold-lg transition-all transform hover:scale-105 flex items-center justify-center gap-2"
						>
							<Send class="w-5 h-5" />
							Enviar Mensagem
						</button>

						<div
							id="form-message"
							class="hidden text-center text-sm"
							role="alert"
							aria-live="polite"
						></div>
					</form>

					<!-- Próximos Passos -->
					<div class="mt-6 md:mt-8 pt-6 border-t border-gold-500/20">
						<h4 class="text-sm font-semibold text-gold-500 mb-4">O que acontece a seguir?</h4>
						<div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-xs text-gray-400">
							<div class="flex gap-2">
								<div class="w-6 h-6 rounded-full bg-gold-500/20 flex items-center justify-center flex-shrink-0">
									<span class="text-gold-500 font-bold text-[10px]">1</span>
								</div>
								<div>
									<p class="font-medium text-gray-300 mb-1">Recebemos o pedido</p>
									<p>A sua mensagem é registada e encaminhada para a equipa.</p>
								</div>
							</div>
							<div class="flex gap-2">
								<div class="w-6 h-6 rounded-full bg-gold-500/20 flex items-center justify-center flex-shrink-0">
									<span class="text-gold-500 font-bold text-[10px]">2</span>
								</div>
								<div>
									<p class="font-medium text-gray-300 mb-1">Análise do contexto</p>
									<p>Um consultor avalia o enquadramento do seu pedido.</p>
								</div>
							</div>
							<div class="flex gap-2">
								<div class="w-6 h-6 rounded-full bg-gold-500/20 flex items-center justify-center flex-shrink-0">
									<span class="text-gold-500 font-bold text-[10px]">3</span>
								</div>
								<div>
									<p class="font-medium text-gray-300 mb-1">Contacto de retorno</p>
									<p>Entramos em contacto para alinhar os próximos passos.</p>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Map and Contact Info -->
				<div class="space-y-6 mt-10 md:mt-0">
					<!-- Map -->
					<div class="glass-dark rounded-3xl overflow-hidden border border-gold-500/20 animate-on-scroll" style="animation-delay: 0.1s;">
						<div class="h-80 w-full bg-dark-50/50 relative">
							<iframe 
								src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3586.123456789!2d32.5731!3d-25.9692!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x1ee69b1a1b1b1b1b%3A0x1b1b1b1b1b1b1b1b!2sAvenida%20Julius%20Nyerere%2C%20Maputo%2C%20Mozambique!5e0!3m2!1spt-PT!2smz!4v1234567890123!5m2!1spt-PT!2smz"
								width="100%" 
								height="100%" 
								style="border:0;" 
								allowfullscreen="" 
								loading="lazy" 
								referrerpolicy="no-referrer-when-downgrade"
								class="w-full h-full"
								title="Localização BMC Pro Services - Avenida Julius Nyerere, Maputo"
							></iframe>
						</div>
						<div class="p-5 md:p-6">
							<div class="flex items-start gap-3">
								<MapPin class="w-5 h-5 text-gold-500 mt-1 flex-shrink-0" />
								<div>
									<h3 class="text-gold-500 font-semibold mb-1">Nossa Localização</h3>
									<p class="text-gray-300 text-sm">
										Avenida Julius Nyerere<br />
										Maputo, Moçambique
									</p>
									<a 
										href="https://www.google.com/maps/search/?api=1&query=Avenida+Julius+Nyerere+Maputo+Mozambique" 
										target="_blank" 
										rel="noopener noreferrer"
										class="text-gold-500 hover:text-gold-400 text-xs mt-2 inline-block transition-colors"
									>
										Ver no Google Maps →
									</a>
								</div>
							</div>
						</div>
					</div>

					<!-- Quick Contact Info -->
					<div class="glass-dark rounded-3xl p-5 md:p-6 border border-gold-500/20 animate-on-scroll" style="animation-delay: 0.2s;">
						<h3 class="text-gold-500 font-semibold mb-4">Contacto Rápido</h3>
						<div class="space-y-4">
							<a href="mailto:geral@bmcpro.co.mz" class="flex items-center gap-3 text-gray-300 hover:text-gold-500 transition-colors group">
								<div class="w-10 h-10 rounded-lg bg-gold-500/10 flex items-center justify-center group-hover:bg-gold-500/20 transition-colors">
									<Mail class="w-5 h-5 text-gold-500" />
								</div>
								<div>
									<p class="text-xs text-gray-400">Email</p>
									<p class="text-sm font-medium">geral@bmcpro.co.mz</p>
								</div>
							</a>
							
							<a href="tel:+258820883478" class="flex items-center gap-3 text-gray-300 hover:text-gold-500 transition-colors group">
								<div class="w-10 h-10 rounded-lg bg-gold-500/10 flex items-center justify-center group-hover:bg-gold-500/20 transition-colors">
									<Phone class="w-5 h-5 text-gold-500" />
								</div>
								<div>
									<p class="text-xs text-gray-400">Telefone</p>
									<p class="text-sm font-medium">82 088 3478</p>
								</div>
							</a>
							
							<a href="tel:+258848509143" class="flex items-center gap-3 text-gray-300 hover:text-gold-500 transition-colors group">
								<div class="w-10 h-10 rounded-lg bg-gold-500/10 flex items-center justify-center group-hover:bg-gold-500/20 transition-colors">
									<Phone class="w-5 h-5 text-gold-500" />
								</div>
								<div>
									<p class="text-xs text-gray-400">Telefone Alternativo</p>
									<p class="text-sm font-medium">84 850 9143</p>
								</div>
							</a>
						</div>
					</div>

					<!-- Horários de Atendimento -->
					<div class="glass-dark rounded-3xl p-5 md:p-6 border border-gold-500/20 animate-on-scroll" style="animation-delay: 0.3s;">
						<div class="flex items-center gap-2 mb-4">
							<Clock class="w-5 h-5 text-gold-500" />
							<h3 class="text-gold-500 font-semibold">Horários de Atendimento</h3>
						</div>
						<div class="space-y-2 text-sm">
							<div class="flex justify-between text-gray-300">
								<span>Segunda a Sexta</span>
								<span class="text-gold-500 font-medium">08:00 - 17:00</span>
							</div>
							<div class="flex justify-between text-gray-300">
								<span>Sábado</span>
								<span class="text-gold-500 font-medium">09:00 - 13:00</span>
							</div>
							<div class="flex justify-between text-gray-400">
								<span>Domingo e Feriados</span>
								<span>Encerrado</span>
							</div>
						</div>
					</div>

					<!-- FAQ Rápido -->
					<div class="glass-dark rounded-3xl p-5 md:p-6 border border-gold-500/20 animate-on-scroll" style="animation-delay: 0.4s;">
						<h3 class="text-gold-500 font-semibold mb-4">Perguntas Frequentes</h3>
						<div class="space-y-4 text-sm">
							<div>
								<p class="font-medium text-gray-300 mb-1">Que tipo de projectos a BMC Pro apoia?</p>
								<p class="text-gray-400 text-xs">Actuamos em consultoria empresarial, procurement, inovação digital, planeamento territorial e desenvolvimento organizacional.</p>
							</div>
							<div>
								<p class="font-medium text-gray-300 mb-1">Atendem apenas em Moçambique?</p>
								<p class="text-gray-400 text-xs">A nossa base é em Maputo, mas podemos apoiar projectos em outras províncias e países da região.</p>
							</div>
							<div>
								<p class="font-medium text-gray-300 mb-1">Posso agendar uma reunião presencial?</p>
								<p class="text-gray-400 text-xs">Sim. Indique essa preferência na mensagem ou contacte-nos directamente por telefone.</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

<script>
	const form = document.getElementById('contact-form-element');
	const messageDiv = document.getElementById('form-message');

	// Base da API: se PUBLIC_API_URL estiver definido (build estático em Hostinger),
	// usamos esse domínio; caso contrário, usamos o backend no mesmo host (/api/contact).
	const API_BASE = import.meta.env.PUBLIC_API_URL || '';
	const CONTACT_ENDPOINT = API_BASE
		? `${API_BASE.replace(/\/$/, '')}/api/contact`
		: '/api/contact';
	
	if (form) {
		form.addEventListener('submit', async (e) => {
			e.preventDefault();
			
			const formData = new FormData(form);
			const data = Object.fromEntries(formData);
			
			// Show loading state
			const submitButton = form.querySelector('button[type="submit"]');
			const originalText = submitButton?.innerHTML;
			if (submitButton) {
				submitButton.disabled = true;
				submitButton.innerHTML = '<span class="animate-spin">⏳</span> Enviando...';
			}
			
			// API call to backend
			try {
				const response = await fetch(CONTACT_ENDPOINT, {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(data)
				});

				const result = await response.json();

				if (response.ok && result.success) {
					// Show success message
					if (messageDiv) {
						messageDiv.classList.remove('hidden');
						messageDiv.classList.remove('text-red-400');
						messageDiv.classList.add('text-green-400');
						messageDiv.textContent = '✓ ' + result.message;
					}
					
					// Reset form
					form.reset();
				} else {
					// Show error message
					if (messageDiv) {
						messageDiv.classList.remove('hidden');
						messageDiv.classList.remove('text-green-400');
						messageDiv.classList.add('text-red-400');
						messageDiv.textContent = '✗ ' + (result.error || 'Erro ao enviar mensagem. Por favor, tente novamente.');
					}
				}
			} catch (error) {
				console.error('Erro ao enviar formulário:', error);
				// Show error message
				if (messageDiv) {
					messageDiv.classList.remove('hidden');
					messageDiv.classList.remove('text-green-400');
					messageDiv.classList.add('text-red-400');
					messageDiv.textContent = '✗ Erro de conexão. Por favor, verifique a sua ligação à internet e tente novamente.';
				}
			} finally {
				// Reset button
				if (submitButton) {
					submitButton.disabled = false;
					submitButton.innerHTML = originalText || 'Enviar Mensagem';
				}
				
				// Hide message after 5 seconds
				setTimeout(() => {
					if (messageDiv) {
						messageDiv.classList.add('hidden');
					}
				}, 5000);
			}
		});
	}
</script>

